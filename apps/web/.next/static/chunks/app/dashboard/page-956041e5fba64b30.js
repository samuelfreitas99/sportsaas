(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6806:function(e,t,a){Promise.resolve().then(a.bind(a,632))},632:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(7437),s=a(2265),l=a(826),n=a(4033);function o(){var e,t,a;let[o,c]=(0,s.useState)([]),[d,i]=(0,s.useState)(null),[u,x]=(0,s.useState)([]),[m,g]=(0,s.useState)([]),[h,p]=(0,s.useState)(null),[N,b]=(0,s.useState)(!0),[v,j]=(0,s.useState)(""),[y,f]=(0,s.useState)({title:"",sport:"",location:"",start_at:""}),[w,C]=(0,s.useState)({type:"INCOME",amount:0,description:"",occurred_at:""}),I=(0,n.useRouter)();(0,s.useEffect)(()=>{_()},[]),(0,s.useEffect)(()=>{d?(O(d.id),E(d.id),k(d.id)):(x([]),g([]),p(null))},[d]);let _=async()=>{try{let e=(await l.Z.get("/orgs/")).data;c(e);let t=localStorage.getItem("currentOrgId"),a=(t?e.find(e=>e.id===t):null)||e[0]||null;i(a),a&&localStorage.setItem("currentOrgId",a.id),b(!1)}catch(e){console.error(e),I.push("/login")}},S=async()=>{try{let e=(await l.Z.post("/orgs/",{name:v})).data,t=[...o,e];c(t),i(e),localStorage.setItem("currentOrgId",e.id),j("")}catch(e){console.error(e),alert("Failed to create org")}},O=async e=>{try{let t=await l.Z.get("/orgs/".concat(e,"/games"));x(t.data)}catch(e){console.error(e),x([])}},E=async e=>{try{let t=await l.Z.get("/orgs/".concat(e,"/ledger/summary"));p(t.data)}catch(e){console.error(e),p(null)}},k=async e=>{try{var t;let a=await l.Z.get("/orgs/".concat(e,"/ledger"));g((null!==(t=a.data)&&void 0!==t?t:[]).slice(0,20))}catch(e){console.error(e),g([])}},Z=e=>e?new Date(e).toISOString():e,G=async()=>{if(d)try{await l.Z.post("/orgs/".concat(d.id,"/ledger"),{...w,occurred_at:Z(w.occurred_at)}),k(d.id),E(d.id),C({type:"INCOME",amount:0,description:"",occurred_at:""})}catch(e){console.error(e),alert("Failed to create ledger entry")}},L=async()=>{if(d)try{await l.Z.post("/orgs/".concat(d.id,"/games"),{...y,start_at:Z(y.start_at)}),O(d.id),f({title:"",sport:"",location:"",start_at:""})}catch(e){console.error(e),alert("Failed to create game")}},A=async(e,t)=>{try{await l.Z.post("/games/".concat(e,"/attendance"),{status:t}),alert("Attendance marked!")}catch(e){console.error(e),alert("Failed to mark attendance")}};return N?(0,r.jsx)("div",{className:"p-8",children:"Loading..."}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 p-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Dashboard"}),(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("currentOrgId"),I.push("/login")},className:"text-red-500",children:"Logout"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,r.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Organizations"}),(0,r.jsx)("ul",{children:o.map(e=>(0,r.jsx)("li",{className:"p-2 cursor-pointer rounded ".concat((null==d?void 0:d.id)===e.id?"bg-blue-100 text-blue-600":"hover:bg-gray-100"),onClick:()=>{i(e),localStorage.setItem("currentOrgId",e.id)},children:e.name},e.id))}),(0,r.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,r.jsx)("input",{className:"w-full border p-2 rounded mb-2",placeholder:"New Org Name",value:v,onChange:e=>j(e.target.value)}),(0,r.jsx)("button",{onClick:S,className:"w-full bg-blue-500 text-white p-2 rounded",disabled:!v.trim(),children:"Create Org"})]})]}),(0,r.jsx)("div",{className:"col-span-3 space-y-8",children:d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white p-6 rounded shadow grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"Income"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-green-500",children:["$",null!==(e=null==h?void 0:h.total_income)&&void 0!==e?e:0]})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"Expense"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-red-500",children:["$",null!==(t=null==h?void 0:h.total_expense)&&void 0!==t?t:0]})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"Balance"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-blue-500",children:["$",null!==(a=null==h?void 0:h.balance)&&void 0!==a?a:0]})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded shadow",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Ledger"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-2 mb-4",children:[m.map(e=>(0,r.jsxs)("div",{className:"border p-3 rounded flex justify-between items-center text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-bold ".concat("INCOME"===e.type?"text-green-600":"text-red-600"),children:e.type}),(0,r.jsx)("span",{className:"mx-2 text-gray-400",children:"|"}),(0,r.jsx)("span",{children:e.description})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"font-bold",children:["$",e.amount]}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.occurred_at).toLocaleString()})]})]},e.id)),0===m.length&&(0,r.jsx)("p",{className:"text-gray-500 text-center italic",children:"No entries yet."})]}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsx)("h3",{className:"font-bold mb-2",children:"Add Entry"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)("select",{className:"border p-2 rounded",value:w.type,onChange:e=>C({...w,type:e.target.value}),children:[(0,r.jsx)("option",{value:"INCOME",children:"Income"}),(0,r.jsx)("option",{value:"EXPENSE",children:"Expense"})]}),(0,r.jsx)("input",{type:"number",className:"border p-2 rounded",placeholder:"Amount",value:w.amount,onChange:e=>C({...w,amount:parseFloat(e.target.value)||0})}),(0,r.jsx)("input",{className:"border p-2 rounded col-span-2",placeholder:"Description",value:w.description,onChange:e=>C({...w,description:e.target.value})}),(0,r.jsx)("input",{type:"datetime-local",className:"border p-2 rounded col-span-2",value:w.occurred_at,onChange:e=>C({...w,occurred_at:e.target.value})})]}),(0,r.jsx)("button",{onClick:G,className:"mt-2 bg-green-600 text-white px-4 py-2 rounded w-full",children:"Add Entry"})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded shadow",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Games"}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-4 mb-4",children:u.map(e=>(0,r.jsxs)("div",{className:"border p-4 rounded flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-bold",children:e.title}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[e.sport," @ ",e.location]}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:new Date(e.start_at).toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>A(e.id,"GOING"),className:"bg-green-100 text-green-700 px-3 py-1 rounded hover:bg-green-200",children:"Going"}),(0,r.jsx)("button",{onClick:()=>A(e.id,"MAYBE"),className:"bg-yellow-100 text-yellow-700 px-3 py-1 rounded hover:bg-yellow-200",children:"Maybe"}),(0,r.jsx)("button",{onClick:()=>A(e.id,"NOT_GOING"),className:"bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200",children:"Not Going"})]})]},e.id))}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsx)("h3",{className:"font-bold mb-2",children:"Create Game"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)("input",{className:"border p-2 rounded",placeholder:"Title",value:y.title,onChange:e=>f({...y,title:e.target.value})}),(0,r.jsx)("input",{className:"border p-2 rounded",placeholder:"Sport",value:y.sport,onChange:e=>f({...y,sport:e.target.value})}),(0,r.jsx)("input",{className:"border p-2 rounded",placeholder:"Location",value:y.location,onChange:e=>f({...y,location:e.target.value})}),(0,r.jsx)("input",{className:"border p-2 rounded",type:"datetime-local",value:y.start_at,onChange:e=>f({...y,start_at:e.target.value})})]}),(0,r.jsx)("button",{onClick:L,className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded",children:"Add Game"})]})]})]}):(0,r.jsx)("div",{className:"bg-white p-8 rounded shadow text-center",children:(0,r.jsx)("h2",{className:"text-xl",children:"Select or create an organization to get started"})})})]})]})}},826:function(e,t,a){"use strict";var r,s=a(4829),l=a(2601);let n=s.Z.create({baseURL:null!==(r=l.env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:8000/api/v1"});n.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),n.interceptors.response.use(e=>e,e=>{var t;return 401===(null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),localStorage.removeItem("currentOrgId"),window.location.href="/login"),Promise.reject(e)}),t.Z=n},4033:function(e,t,a){e.exports=a(5313)}},function(e){e.O(0,[737,971,938,744],function(){return e(e.s=6806)}),_N_E=e.O()}]);